#!/usr/bin/env sh

### ---Environment variables---
# PATH
# this is already in ~/.profile but that does not fire for new panes in tmux
if [ -d "$HOME/.local/bin" ]; then
  PATH="$HOME/.local/bin:$PATH"
fi

# ---XDG---
### (these might be the defaults but I like them explicit.)
### also see /home/tom/.config/user-dirs.dirs
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_DATA_HOME="$HOME/.local/share"
export XDG_CACHE_HOME="$HOME/.cache"
export XDG_STATE_HOME="$HOME/.local/state"

### All is vim
export MANPAGER='nvim +Man!'
export VISUAL=nvim
export EDITOR=nvim

# ---OTHER APPS---
# Qt theme (needed if you use Qt apps)
export QT_QPA_PLATFORMTHEME=gtk2
# fix no menus in ghidra (java app expecting window reparenting)
export _JAVA_AWT_WM_NONREPARENTING=1

# User directories
xdg-user-dirs-update

# Screen timeout
xset -dpms && xset s 600

# --- Keys ---
# NOTE: 2025-01-11
# Goal: redox gets us, all else get realprog
# I have been fighting with this for 4 hours via /etc/default/keyboard and /etc/X11/xorg.conf.d-scripts.
# I am doing this here now as per gemini's advive. at least this did survive a log out.
#
# Set layout before running sxhkd
# because gemini says it captures keycoded based on
# layout active when it starts
# 1. Ensure the global default is US (for Redox and others)
setxkbmap us

# 2. Target the Apple Keyboard specifically by its name
# We use xinput to find the ID dynamically in case it changes
APPLE_ID=$(xinput list --id-only "Apple Inc. Apple Internal Keyboard / Trackpad")

if [ -n "$APPLE_ID" ]; then
  setxkbmap -device "$APPLE_ID" realprog
fi

# ---BUSSES---
# Accessibility bus (some GTK apps break without it)
/usr/libexec/at-spi-bus-launcher --launch-immediately &

# Authentication agent (essential for GUI sudo prompts)
/usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1 &

# Audio (your main concern)
# run this in background?
pipewire-start &
