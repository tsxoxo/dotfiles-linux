#!/usr/bin/env bash
# start helper daemon to save id of last focused window in `~/.last_window`.
# works in tandem with sxhkd:
#
# Switch to last focused window
# alt + w ; w
#   xdotool windowactivate "$(cat ~/.last_window)" 2>/dev/null || :

# Initialize from current state
current=$(xprop -root _NET_ACTIVE_WINDOW | grep -o '0x[0-9a-f]*')
previous=$(cat ~/.last_window 2>/dev/null || echo "")

xprop -spy -root _NET_ACTIVE_WINDOW | while read line; do
  new_id=$(echo "$line" | grep -o '0x[0-9a-f]*')
  if [ "$new_id" != "$current" ]; then
    previous="$current"
    current="$new_id"
    echo "$previous" >~/.last_window
  fi
done
